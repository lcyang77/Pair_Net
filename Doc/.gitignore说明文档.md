# .gitignore 说明文档

> 本文档说明项目.gitignore文件的配置和使用方法

## 📋 文件结构

.gitignore文件分为以下几个主要部分：

### 1️⃣ ESP-IDF构建系统 (最重要)

```gitignore
/build/              # 编译输出目录（包含所有二进制文件）
sdkconfig            # 项目配置文件（从sdkconfig.defaults生成）
managed_components/  # ESP组件管理器下载的组件
```

**为什么忽略？**
- `build/` 目录包含所有编译产物，体积大且可重新生成
- `sdkconfig` 是自动生成的，应该提交 `sdkconfig.defaults` 作为配置源
- `managed_components/` 可以通过依赖管理自动下载

**应该提交的文件：**
- ✅ `sdkconfig.defaults` - 默认配置（源文件）
- ✅ `partitions.csv` - 分区表定义
- ✅ `CMakeLists.txt` - 构建配置

---

### 2️⃣ Python虚拟环境

```gitignore
venv/
.venv/
__pycache__/
```

**为什么忽略？**
- ESP-IDF使用Python工具，通常会创建虚拟环境
- 虚拟环境可以通过 `requirements.txt` 重建
- Python缓存文件是临时文件

---

### 3️⃣ IDE和编辑器配置

```gitignore
.vscode/         # VS Code配置
.idea/           # JetBrains IDEs
*.sublime-*      # Sublime Text
*.swp            # Vim临时文件
```

**特殊处理：**
```gitignore
.vscode/
!.vscode/settings.json    # 保留团队共享的设置
!.vscode/tasks.json       # 保留构建任务
!.vscode/launch.json      # 保留调试配置
```

**建议：**
- 团队共享的IDE配置可以提交
- 个人偏好配置应该忽略

---

### 4️⃣ 操作系统文件

```gitignore
# Windows
Thumbs.db
Desktop.ini

# macOS
.DS_Store
._*

# Linux
*~
.directory
```

**为什么忽略？**
- 这些是操作系统自动生成的元数据文件
- 对项目功能无影响
- 会污染仓库

---

### 5️⃣ 编译和二进制文件

```gitignore
*.o              # 目标文件
*.a              # 静态库
*.so             # 动态库
*.bin            # 二进制文件
*.elf            # 可执行文件
```

**例外：**
```gitignore
!partitions.csv   # 保留分区表配置
```

---

### 6️⃣ ESP-IDF特定文件

```gitignore
flash_project_args      # Flash配置（自动生成）
bootloader.bin          # Bootloader二进制（编译产物）
partition-table.bin     # 分区表二进制（编译产物）
size.json              # 代码大小分析（自动生成）
```

**重要：**
这些都是编译产物，可以从源代码重新生成

---

### 7️⃣ ⚠️ 凭据和密钥（极其重要！）

```gitignore
*secrets*
*credentials*
*.pem
*.key
*.crt
.env
secrets.h
credentials.h
```

**严格规则：**
- ❌ **绝对不要** 提交任何密钥、证书、密码
- ❌ **绝对不要** 提交WiFi密码、MQTT密码
- ❌ **绝对不要** 提交设备私钥

**正确做法：**
```c
// ❌ 错误：直接写在代码里
#define WIFI_SSID "MyHomeWiFi"
#define WIFI_PASS "MyPassword123"

// ✅ 正确：从配置文件读取
#include "secrets.h"  // 这个文件不提交到Git
// secrets.h中定义WIFI_SSID和WIFI_PASS
```

**创建模板文件：**
```bash
# 提交模板（不含真实密码）
secrets.h.template

# 本地使用（包含真实密码，不提交）
secrets.h
```

---

## 🔧 使用方法

### 首次使用

1. **确认.gitignore已生效**
```bash
cd D:\indie\Graduation_Design_Project_Code\Pair_Network
git status

# 应该看不到build/目录和sdkconfig文件
```

2. **如果之前已提交了不该提交的文件**
```bash
# 从Git中移除但保留本地文件
git rm --cached -r build/
git rm --cached sdkconfig

# 提交删除操作
git commit -m "Update .gitignore and remove build artifacts"
```

---

### 检查哪些文件会被忽略

```bash
# 检查特定文件是否被忽略
git check-ignore -v build/main.bin
# 输出：.gitignore:16:*.bin    build/main.bin

# 查看所有被忽略的文件
git status --ignored
```

---

### 强制添加被忽略的文件（谨慎使用）

```bash
# 如果确实需要提交某个被忽略的文件
git add -f some_file.bin
```

⚠️ **警告**：通常不应该这样做！

---

## 📊 当前项目应该提交的文件

### ✅ 必须提交

```
📁 Pair_Network/
├── 📄 .gitignore                    # 本文件
├── 📄 CMakeLists.txt                # 主构建配置
├── 📄 partitions.csv                # 分区表
├── 📄 sdkconfig.defaults            # 默认配置
├── 📄 CLAUDE.md                     # 项目说明
├── 📄 README.md                     # 项目介绍
│
├── 📁 main/
│   ├── 📄 CMakeLists.txt
│   ├── 📄 main.c
│   ├── 📄 product.c
│   ├── 📄 product.h
│   └── 📁 gs/                       # 所有.c .h文件
│
├── 📁 components/
│   ├── 📁 cc/                       # 所有源码和头文件
│   ├── 📁 http_client/
│   └── ...
│
└── 📁 Doc/                          # 文档目录
    └── *.md
```

### ❌ 不应提交

```
📁 Pair_Network/
├── 📁 build/                        # 编译产物（忽略）
├── 📄 sdkconfig                     # 生成的配置（忽略）
├── 📁 managed_components/           # 依赖组件（忽略）
├── 📁 .vscode/                      # IDE配置（部分忽略）
├── 📁 __pycache__/                  # Python缓存（忽略）
└── 📄 *.log                         # 日志文件（忽略）
```

---

## 🎯 最佳实践

### 1. 定期检查Git状态

```bash
# 提交前检查
git status

# 确认只有预期的文件
git diff --staged
```

### 2. 使用Git的pre-commit钩子

创建 `.git/hooks/pre-commit`：
```bash
#!/bin/sh

# 检查是否提交了敏感文件
if git diff --cached --name-only | grep -E "(secrets|credentials|\.key|\.pem)"; then
    echo "错误：检测到敏感文件，提交被拒绝！"
    exit 1
fi

# 检查是否提交了大文件
if git diff --cached --name-only | xargs ls -l 2>/dev/null | awk '{if($5 > 1048576) print $9}' | grep .; then
    echo "警告：检测到超过1MB的文件"
fi
```

### 3. 使用.gitattributes统一换行符

创建 `.gitattributes`：
```
# 文本文件自动转换换行符
*.c text eol=lf
*.h text eol=lf
*.md text eol=lf
*.py text eol=lf

# 二进制文件
*.bin binary
*.elf binary
*.a binary
```

---

## 🆘 常见问题

### Q1: 我不小心提交了build目录，怎么办？

```bash
# 1. 从Git历史中删除
git rm -r --cached build/

# 2. 提交删除操作
git commit -m "Remove build directory from git"

# 3. 强制推送（如果已推送到远程）
git push origin main --force  # ⚠️ 谨慎使用
```

### Q2: .gitignore不生效？

**原因**：文件已经被Git跟踪

**解决**：
```bash
# 清除Git缓存
git rm -r --cached .
git add .
git commit -m "Update .gitignore"
```

### Q3: 我需要临时提交一个.bin文件怎么办？

```bash
# 强制添加
git add -f myfile.bin

# 或修改.gitignore添加例外
!myspecific.bin
```

### Q4: 如何查看.gitignore的匹配规则？

```bash
# 查看某文件被哪条规则忽略
git check-ignore -v path/to/file

# 列出所有被忽略的文件
git ls-files --others --ignored --exclude-standard
```

---

## 📝 团队协作建议

### 提交前检查清单

- [ ] 运行 `git status` 检查文件列表
- [ ] 确认没有 `build/` 目录
- [ ] 确认没有 `sdkconfig` 文件（只提交sdkconfig.defaults）
- [ ] 确认没有密钥、密码等敏感信息
- [ ] 确认没有大型二进制文件（除非必要）
- [ ] 确认提交信息清晰明了

### 推荐的.gitignore维护流程

1. **发现需要忽略的新文件类型**
   - 在团队会议中讨论
   - 更新.gitignore
   - 提交并推送

2. **定期审查**
   - 每月检查一次.gitignore
   - 删除过时的规则
   - 添加新的规则

3. **文档化**
   - 在README.md中说明哪些文件需要本地配置
   - 提供配置模板文件

---

## 🔗 相关资源

- [Git官方文档 - gitignore](https://git-scm.com/docs/gitignore)
- [GitHub gitignore模板](https://github.com/github/gitignore)
- [ESP-IDF文档](https://docs.espressif.com/projects/esp-idf/)

---

> 最后更新：2025年
> 维护者：项目团队
